WSROOT="$(x wsroot)"
clone_xcmd_pkg()(
    x rmrf "$WSROOT/tmp"
    x mkdirp "$WSROOT/tmp"
    cd "$WSROOT/tmp" || return
    git clone git@gitee.com:x-cmd/pkg.git
)

f()(

    clone_xcmd_pkg || return
    x:info "Copy $WSROOT/dist to $WSROOT/tmp/pkg"

    rm -rf "$WSROOT/tmp/pkg/dist"
    mkdir "$WSROOT/tmp/pkg/dist"
    cp -r "$WSROOT/dist/all.7z" "$WSROOT/tmp/pkg/dist"

    if cd "$WSROOT/tmp/pkg" ; then
        git add "dist/all.7z"

        if [ "$git_user" = "agent-zero" ]; then
            git commit -m "build: release x-cmd pkg bundle"
        else
            git commit -m "update: dist/all.tgz"
        fi
        git push origin main

    fi
    x rmrf "$WSROOT/tmp"
)

f